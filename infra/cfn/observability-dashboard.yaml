AWSTemplateFormatVersion: "2010-09-09"
Description: CloudWatch Dashboard for MasterProject

Resources:
  MasterProjectDashboard:
    Type: AWS::CloudWatch::Dashboard
    Properties:
      DashboardName: MasterProjectDashboard
      DashboardBody: !Sub
        - |
          {
            "widgets": [
              {
                "type": "metric",
                "x": 0,
                "y": 0,
                "width": 12,
                "height": 6,
                "properties": {
                  "metrics": [
                    [ "AWS/ApplicationELB", "TargetResponseTime", "LoadBalancer", "${AlbName}", { "stat": "p95" } ]
                  ],
                  "region": "eu-west-3",
                  "title": "ALB TargetResponseTime (p95)"
                }
              },
              {
                "type": "metric",
                "x": 0,
                "y": 6,
                "width": 12,
                "height": 6,
                "properties": {
                  "metrics": [
                    [ "AWS/ApplicationELB", "HTTPCode_ELB_4XX_Count", "LoadBalancer", "${AlbName}" ],
                    [ "AWS/ApplicationELB", "HTTPCode_ELB_5XX_Count", "LoadBalancer", "${AlbName}" ]
                  ],
                  "region": "eu-west-3",
                  "title": "ALB 4XX/5XX"
                }
              },
              {
                "type": "metric",
                "x": 12,
                "y": 0,
                "width": 12,
                "height": 6,
                "properties": {
                  "metrics": [
                    [ "AWS/EC2", "CPUUtilization", "InstanceId", "${InstanceId1}" ],
                    [ "AWS/EC2", "CPUUtilization", "InstanceId", "${InstanceId2}" ]
                  ],
                  "region": "eu-west-3",
                  "title": "EC2 CPU"
                }
              },
              {
                "type": "metric",
                "x": 12,
                "y": 6,
                "width": 12,
                "height": 6,
                "properties": {
                  "metrics": [
                    [ "MasterProject3", "AppErrorCount" ]
                  ],
                  "region": "eu-west-3",
                  "title": "AppErrorCount"
                }
              }
            ]
          }
        - 
          AlbName: !ImportValue AlbName
          InstanceId1: i-0fa4ea81e88991e74
          InstanceId2: i-06b4f99a0134abaed

Outputs:
  DashboardName:
    Description: "CloudWatch Dashboard Name"
    Value: !Ref MasterProjectDashboard
    Export:
      Name: MasterProjectDashboardName
